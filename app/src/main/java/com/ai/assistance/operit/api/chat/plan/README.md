# 深度搜索模式（计划模式）

## 概述

深度搜索模式是一个高级的AI对话功能，它能够将复杂的用户请求分解为多个子任务，并并发或按依赖关系顺序执行这些任务，最终汇总所有结果提供综合性的回答。

## 工作原理

1. **任务分解**: AI首先分析用户的复杂请求，将其分解为3-6个相对独立的子任务
2. **依赖分析**: 确定任务之间的依赖关系，支持并发执行无依赖的任务
3. **任务执行**: 按照拓扑排序的顺序执行所有子任务
4. **结果汇总**: 将所有子任务的结果汇总，提供最终的完整回答

## 文件结构

- `PlanModels.kt`: 定义任务节点和执行图的数据模型
- `PlanParser.kt`: 解析AI生成的执行计划并提供拓扑排序功能
- `TaskExecutor.kt`: 执行具体的任务并管理任务依赖关系
- `PlanModeManager.kt`: 整个深度搜索模式的核心协调器

## 使用场景

深度搜索模式特别适合以下类型的请求：

- 需要多角度分析的复杂问题
- 涉及多个步骤的任务规划
- 需要综合考虑多个因素的决策制定
- 详细的研究和调查需求

## 启用条件

1. 用户在设置中启用了"AI计划模式"
2. 消息内容符合复杂性判断标准：
   - 消息长度超过50字符，或
   - 包含特定的复杂性关键词（如"分析"、"比较"、"详细"等）

## 示例

用户输入：
```
请详细分析Python和Java的区别，包括语法特性、性能表现、应用场景等多个方面
```

系统会自动：
1. 生成包含多个子任务的执行计划（如语法分析、性能比较、应用场景对比等）
2. 并发执行这些子任务
3. 汇总所有结果提供全面的比较分析

## 配置

深度搜索模式的启用可以通过 `ApiPreferences` 中的 `enableAiPlanningFlow` 配置项进行控制。 